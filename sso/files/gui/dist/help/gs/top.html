<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <title>SaltStack Top File - QuickStart Guide</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="schema.DC" href="http://purl.org/dc/terms/">
      <meta name="DC.Type" content="concept">
      
      <meta name="DC.Title" content="SaltStack Enterprise Help Center">
      
      <meta name="abstract" content="">
      
      <meta name="description" content="">
      
      <meta name="DC.Format" content="XHTML">
      
      <meta name="DC.Identifier" content="concept_z5t_tpb_gq">

       <link rel="stylesheet" type="text/css" media="screen, projection" href="../themes/gui/css/core.min.css">
       <link rel="stylesheet" type="text/css" media="screen, projection" href="../themes/gui/css/getstarted.min.css">

       <script type="text/javascript" src="../themes/gui/js/webhelp.min.js"></script>

   </head>
   <body>
   <a id="ss-logo-jumbotron" href="/help/ent/gui.html"></a>
      <div class="jumbotron active_texture">
          <div class="container">
              <h1><!--<i class="glyphicon glyphicon-question-sign"></i>-->SaltStack Fundamentals</h1>
              <h3>Get Started Guide</h3>
          </div>
      </div>
      <div id="wrapper" class="intro">


              <div class="container-fluid">
                  <div class="row">
                      <div class="col-lg-12">
                          <ol class="progtrckr" data-progtrckr-steps="7">
                              <!--<li class="progtrckr-done"><a href="overview.html">Overview</a></li>-->
                              <li class="progtrckr-done"><a href="index.html">Demo Environment</a></li>
                              <li class="progtrckr-done"><a href="install.html">Install SaltStack</a></li>
                              <li class="progtrckr-done"><a href="remotex.html">Execute Commands</a></li>
                              <li class="progtrckr-done"><a href="targeting.html">Target Systems</a></li>
                              <li class="progtrckr-done"><a href="formulas.html">Create a Salt Formula</a></li>
                              <li class="progtrckr-done">Apply and Target Formulas</li>

                              <li class="progtrckr-todo"><a href="next.html">Next Steps</a></li>
                          </ol>
                      </div>
                      </div>

                <!--<div class="row">
                    <div class="col-lg-12"></div>
                </div>-->
<div class="row">

</div>


              <div class="row">
                  <div class="col-lg-1"></div>
                  <div class="col-lg-10">


                          <h1 class="title topictitle1">Apply and Target Formulas</h1>
                          <div class="body conbody">
                              <p class="shortdesc"></p>

                              <div class="section gs-overview" id="concept_ivf_bcn_vp__section_EF69791A73AB411AA070F467095A5130">
                                  <p class="p gs-overview-sub"><span class="ph">You'll learn how to:</span></p>

                                  <ul class="ul" id="concept_ivf_bcn_vp__ul_qjt_rhn_tp">
                                      <li class="li" id="concept_ivf_bcn_vp__li_B7E78094456C4DC19C4B6133FC46D104">Create a Top file to match systems with state files
                                      </li>



                                  </ul>

                                  <p class="p gs-overview-sub gs-time"><span class="ph">Estimated time: 15
                                    			 minutes</span>&nbsp;<i class="glyphicon glyphicon-time"></i></p>

                                  <p class="p gs-overview-sub gs-difficulty-2"><span class="ph">Difficulty</span>:
                                      &nbsp;<i class="glyphicon glyphicon-star"></i><i class="glyphicon glyphicon-star"></i><i class="glyphicon glyphicon-star-empty"></i><i class="glyphicon glyphicon-star-empty"></i><i class="glyphicon glyphicon-star-empty"></i>
                                  </p>

                              </div>


                              <div class="section gs-mainbody" id="concept_ivf_bcn_vp__section_D6F77362DCE342D9B67DE9E631A365C6">

                                  <div class="section gs-terms gs-sidebar" id="concept_ivf_bcn_vp__section_043E1272A3E94500934501DFABE4DCF9">
                                      <h4 class="sidebar">SaltStack Formulas Repo</h4>
                                        <p>The Salt Community provides a vast repository of Formulas at <a href="https://github.com/saltstack-formulas" target="_blank">https://github.com/saltstack-formulas</a>.</p>

                                  </div>


                                  <!--<div class="section gs-terms gs-sidebar" id="concept_ivf_bcn_vp__section_043E1272A3E94500934501DFABE4DCF9">

                                      <h4 class="sidebar">What the {{}}{% if %}?</h4>

                                      <p>If you've looked at any sample formulas on the web, you've likely encountered some complex-looking values:</p>

                                      <ul>
                                          <li>{% if grains['os_family'] == 'RedHat' %}...{% endif %}
                                          </li>
                                          <li>{{ apache.server }}</li>
                                      </ul>

                                      <h4>Configurations</h4>


<p>These configurations are 'translated' to YAML and added to the Top file to define your different systems.</p>


                                      <h4 class="sidebar">Environments</h4>

                                      <p>See the 'base:' line at the root of Top file? That line specifies the salt environment where the formula is located. We won't get into environments in this guide, but soon you'll want to define a few environments where you can set up different types of systems depending on where they are deployed. For example, 'apache' in a dev environment will likely need a different network configuration than in a production environment. Learn more in the <a href="http://docs.saltstack.com/en/latest/ref/states/top.html#environments" target="_blank">docs</a>. </p>

                                  </div>-->

                                <!--  <p>So forget about commands and scripts for a while, and


                                  <p>After you have a few configurations defined, you are ready to describe those configurations in Salt State files.</p>-->


                                  <p>Let's review what we've learned so far:</p>
                                  <ul>
                                      <li>How to run a single command from the command line on one or more Salt Minions</li>
                                      <li>Group multiple commands and use new commands to define re-usable Formulas</li>
                                  </ul>

                                  <p>Notice how the Formula we created in the previous section did not contain any information about the Salt Minions that should receive the configuration? Salt Formulas are generic by design, and describe only <i>how</i> a configuration should be achieved. </p><p>In this section we'll learn about a different file, called the Top file, that describes <i>where</i> Formulas should be applied. </p><p>Individual Formulas and the Top file work together to create the core of SaltStack's configuration management capability.</p>



                                  <h2>Introducing the Top File</h2>

                                  <p>The Top file is used to automatically apply multiple Formulas to your Salt Minions. The Formulas that are applied to each system are determined by the targets that are specified in the Top file.</p>


                                  <h2>Create your own Top file</h2>

                                  <p>Before we create a Top file, it might be useful to take a moment to think about what what <i>your</i> system configurations look like. Consider the different types of systems you set up, and what is common and unique about each. Each system can receive multiple configurations, so start with the most general configurations and work your way down to the specifics.</p>

                                  <p>For example, you might start with a simple description similar to the following:</p>

                                  <img class="imgcenter" width="250px" height="auto" src="images/planning1.png"/>


                                  <p>In the SaltStack paradigm, the list itself would be the Top file, and each item on the list would be a Formula. Targets are used within the Top file to define which Formulas are applied to each Salt Minion.</p>

                                  <p>The following example shows how our configurations might be translated to YAML and represented in a Top file:</p>


                                  <img class="imgcenter" width="500px" height="auto" src="images/planning.png"/>

                                  <p>When the Top file is executed, Salt Minions execute all Formulas that are defined for any target that they match. For example, a system with a Minion ID of <samp class="ph codeph">atl-web4-prod</samp> would apply the vim, scripts, users, apache, python, and django Formulas.

                                     <p>Now that we understand the purpose of the Top file, lets go ahead and create one. If you are using the Vagrant demo files you'll notice that there is already a <samp class="ph codeph">top.sls</samp> file in the <samp class="ph codeph">saltstack/salt</samp> folder, so we'll just update that one. Otherwise you can create a new file. Add the following to your <samp class="ph codeph">top.sls</samp> file:</p>

<pre class="pre codeblock language-yaml">
base:
  '*':
    - common
  'minion1':
    - nettools
</pre>

                                  <p>Hopefully it is clear to you what will happen when this is applied, so let's try it. On your Salt Master, run the following command to apply the Top file:</p>

                                  <pre class="pre codeblock language-bash">salt minion2 state.apply
#state.apply is new in 2015.2, so if you are using an earlier version call state.highstate instead.</pre>

                                  <p>As you expected, minion1 and minion2 both applied the common Formula, and minion2 also applied the nettools Formula.</p>

                                  <p>Using what you know about the targeting system, you now know how to create Formulas and run them on the correct Salt Minions using the Top file.</p>
                                  <a href="next.html"><button id="next-button" type="button" class="btn btn-primary">
                                      Next <span class="glyphicon glyphicon-chevron-right"></span></button></a>
                                  <div class="footer"></div>
                              </div>

                              <!--<div class="section gs-scenario" id="concept_ivf_bcn_vp__section_5191FFF18E494D33AA46064EF96D0F57">
                                  <h2 class="title sectiontitle">Scenario</h2>
                                  <p class="p"></p>
                                  <ul>
                                      <li>Salt Master server</li>
                                      <li>Web server</li>
                                      <li>Database server</li>
                                  </ul>


                              </div>-->

                          </div>




                  </div>
                  <div class="col-lg-1"></div>


              </div>
              <div class="row">
                  <div class="col-lg-12">

                  </div>
              </div>

                  </div>
              </div>

   </body>
</html>
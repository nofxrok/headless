<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <title>Grains</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="schema.DC" href="http://purl.org/dc/terms/">
      <meta name="DC.Type" content="concept">
      
      <meta name="DC.Title" content="Grains">
      
      <meta name="DC.Relation" scheme="URI" content="index.html">
      
      <meta name="DC.Format" content="XHTML">
      
      <meta name="DC.Identifier" content="grains">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/bootstrap.min.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/fonts.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/prism.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/lightbox.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/webhelp.css">
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery-1.11.0.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery-ui-1.9.1.custom.min.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery.slimscroll.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery.tocify.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/prism.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/lightbox.min.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/webhelp.js"></script>
      </head>
   <body>
      <div id="wrapper">
         <div id="sidebar-wrapper"><a class="ss-logo" href="/help/home.html"></a><div id="search-form" class="inner-addon left-addon"><i class="glyphicon glyphicon-search"></i><input type="text" class="form-control"></div>
            <div id="guide-links">
               <div class="well">
                  <ul class="nav nav-pills nav-stacked">
                     <li><a href="/help/gs/index.html"><span class="glyphicon glyphicon glyphicon-th-list"></span> Get Started</a></li>
                     <li><a href="/help/home.html"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
                     <li><a href="/help/enterprise/user-guide.html"><span class="glyphicon glyphicon-user"></span> User Guide</a></li>
                  </ul>
               </div>
               <p id="guide-title">Enterprise Help</p>
            </div>
            <div class="sidebar-nav">
               <ul id="gen-links">
                  <li class=" collapsible  collapsed"><a href="../../../enterprise/use-cases.html">Use Cases</a><ul>
                        <li class=" no-child "><a href="../../../enterprise/continuous-deployment.html">Continuous Deployment</a></li>
                        <li class=" no-child "><a href="../../../enterprise/app-stacks.html">Application Stacks</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../enterprise/cloud.html">Cloud Management</a><ul>
                              <li class=" no-child "><a href="../../../enterprise/orchestrate.html">Orchestration</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../enterprise/security-bp.html">Security Best Practices</a></li>
                        <li class=" no-child "><a href="../../../enterprise/components.html">SaltStack Components</a></li>
                     </ul>
                  </li>
                  <li class=" collapsible  collapsed"><a href="../../../enterprise/deployment.html">Deployment</a><ul>
                        <li class=" no-child "><a href="../../../enterprise/t_ops_prepare.html">Preparing the SaltStack Ops System</a></li>
                        <li class=" no-child "><a href="../../../enterprise/t_master_prepare.html">Preparing Masters for SaltStack Ops Integration</a></li>
                        <li class=" no-child "><a href="../../../enterprise/requirements.html">System Requirements</a></li>
                        <li class=" no-child "><a href="../../../enterprise/faq.html">Frequently Asked Questions</a></li>
                     </ul>
                  </li>
                  <li class=" no-child "><a href="../../../enterprise/masters.html">View Masters</a></li>
                  <li class=" no-child "><a href="../../../enterprise/minions.html">View Minions</a></li>
                  <li class=" no-child "><a href="../../../enterprise/jobs.html">Jobs</a></li>
                  <li class=" no-child "><a href="../../../enterprise/targets.html">Targets</a></li>
                  <li class=" collapsible  collapsed"><a href="../../../enterprise/management.html">Admin Management</a><ul>
                        <li class=" no-child "><a href="../../../enterprise/cfg-masters.html">Manage Masters</a></li>
                        <li class=" no-child "><a href="../../../enterprise/jobs-all.html">Manage Jobs</a></li>
                        <li class=" no-child "><a href="../../../enterprise/cfg-users.html">User Accounts</a></li>
                     </ul>
                  </li>
                  <li class=" no-child "><a href="../../../enterprise/web-console-overview.html">Console Overview</a></li>
                  <li class=" no-child "><a href="../../../enterprise/reports.html">View Reports</a></li>
                  <li class=" no-child "><a href="../../../enterprise/architecture.html">Architecture Reference</a></li>
                  <li class=" no-child "><a href="../../../enterprise/glossary.html">Glossary</a></li>
                  <li class=" collapsible  active"><a href="../../../enterprise/user-guide.html">SaltStack User Guide</a><ul>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/installation/index.html">Installation</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/installation/debian.html">Debian Installation</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/freebsd.html">FreeBSD</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/gentoo.html">Gentoo</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/solaris.html">Solaris</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/ubuntu.html">Ubuntu Installation</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/windows.html">Windows</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/tutorials/index.html">Tutorials</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/standalone_minion.html">Standalone Minion</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/cron.html">Using cron with Salt</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/states_pt1.html">States tutorial, part 1 - Basic Usage</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/states_pt2.html">States tutorial, part 2 - More Complex States, Requisites</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/states_pt4.html">States tutorial, part 4</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/minionfs.html">MinionFS Backend Walkthrough</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/multimaster_pki.html">Multi-Master-PKI Tutorial With Failover</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/writing_tests.html">Writing Salt Tests</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/halite.html">Installing and Configuring Halite</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  active"><a href="../../../user/topics/targeting/index.html">Targeting Minions</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/targeting/globbing.html">Matching the minion id</a></li>
                              <li class=" no-child  active">
                                 <div id="toc"></div>
                              </li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/ipcidr.html">Subnet/IP Address Matching</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/compound.html">Compound matchers</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/nodegroups.html">Node groups</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/batch.html">Batch Size</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/range.html">SECO Range</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../user/topics/pillar/index.html">Storing Static Data in the Pillar</a></li>
                        <li class=" no-child "><a href="../../../user/topics/reactor/index.html">Reactor System</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/eauth/index.html">External Authentication System</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/eauth/access_control.html">Access Control System</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/event/index.html">Salt Event System</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/event/master_events.html">Salt Master Events</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../user/topics/topology/syndic.html">Salt Syndic</a></li>
                        <li class=" no-child "><a href="../../../user/topics/topology/proxyminion/index.html">Proxy Minion</a></li>
                        <li class=" no-child "><a href="../../../user/topics/windows/windows-specific-behavior.html">Windows-specific Behaviour</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/cloud/index.html">Salt Cloud</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/cloud/basic.html">Salt Cloud basic usage</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/profiles.html">VM Profiles</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/map.html">Cloud Map File</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/action.html">Cloud Actions</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/function.html">Cloud Functions</a></li>
                              <li class=" collapsible  collapsed"><a href="../../../user/topics/cloud/provider-specifics.html">Cloud Provider Specifics</a><ul>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/parallels.html">Getting Started With Parallels</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/proxmox.html">Getting Started With Proxmox</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/lxc.html">Getting Started With LXC</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/hpcloud.html">Getting Started With HP Cloud</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/vexxhost.html">Getting Started with VEXXHOST</a></li>
                                 </ul>
                              </li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/deploy.html">OS Support for Cloud VMs</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/features.html">Feature Matrix</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/windows.html">Spinning up Windows Minions</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/netapi/index.html">netapi modules</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/netapi/writing.html">Writing netapi modules</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/virt/index.html">Salt Virt</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/virt/disk.html">Virtual Machine Disk Profiles</a></li>
                              <li class=" no-child "><a href="../../../user/topics/virt/nic.html">Virtual Machine Network Profiles</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../user/topics/yaml/index.html">Understanding YAML</a></li>
                        <li class=" no-child "><a href="../../../user/topics/master_tops/index.html">Master Tops System</a></li>
                        <li class=" no-child "><a href="../../../user/topics/best_practices.html">Salt Best Practices</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/troubleshooting/index.html">Troubleshooting</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/troubleshooting/minion.html">Troubleshooting the Salt Minion</a></li>
                           </ul>
                        </li>
                     </ul>
                  </li>
               </ul>
            </div>
         </div>
         <div id="page-content-wrapper">
            <div class="container-fluid">
               <div class="row">
                  <div class="col-lg-12">
                     <div class="page concept  - topic-topic concept-concept " id="grains">
                        
                        <h1 class="title topictitle1">Grains</h1>
                        <div class="body conbody">
                           <p class="p">Salt comes with an interface to derive information about the underlying system.
                              This is called the grains interface, because it presents salt with grains of
                              information.
                           </p>
                           
                           <p class="p">The grains interface is made available to Salt modules and components so that
                              the right salt minion commands are automatically available on the right
                              systems.
                           </p>
                           
                           <p class="p">It is important to remember that grains are bits of information loaded when
                              the salt minion starts, so this information is static. This means that the
                              information in grains is unchanging, therefore the nature of the data is
                              static. So grains information are things like the running kernel, or the
                              operating system.
                           </p>
                           
                           <aside class="note "><span class="title">Note:</span> 
                              <p class="p">Grains resolve to lowercase letters. For example, <tt class="ph tt">FOO</tt>, and <tt class="ph tt">foo</tt>
                                 target the same grain.
                              </p>
                              
                           </aside>
                           
                           <p class="p">Match all CentOS minions:</p>
                           <pre class="pre codeblock language-bash">salt -G 'os:CentOS' test.ping</pre>
                           <p class="p">Match all minions with 64-bit CPUs, and return number of CPU cores for each
                              matching minion:
                           </p>
                           <pre class="pre codeblock language-bash">salt -G 'cpuarch:x86_64' grains.item num_cpus</pre>
                           <p class="p">Additionally, globs can be used in grain matches, and grains that are nested in
                              a <a class="xref" href="http://docs.python.org/2/library/stdtypes.html#typesmapping" target="_blank">dictionary</a> can be matched by adding a colon for
                              each level that is traversed. For example, the following will match hosts that
                              have a grain called <tt class="ph tt">ec2_tags</tt>, which itself is a
                              <a class="xref" href="http://docs.python.org/2/library/stdtypes.html#typesmapping" target="_blank">dict</a> with a key named <tt class="ph tt">environment</tt>, which
                              has a value that contains the word <tt class="ph tt">production</tt>:
                           </p>
                           <pre class="pre codeblock language-bash">salt -G 'ec2_tags:environment:*production*'</pre>
                           <div class="section" id="grains__listing-grains">
                              <h2 class="title sectiontitle">Listing Grains</h2>
                              <p class="p">Available grains can be listed by using the 'grains.ls' module:</p>
                              <pre class="pre codeblock language-bash">salt '*' grains.ls</pre>
                              <p class="p">Grains data can be listed by using the 'grains.items' module:</p>
                              <pre class="pre codeblock language-bash">salt '*' grains.items</pre>
                              </div>
                           
                           <div class="section" id="grains__grains-in-the-minion-config">
                              <h2 class="title sectiontitle">Grains in the Minion Config</h2>
                              <p class="p">Grains can also be statically assigned within the minion configuration file.
                                 Just add the option <tt class="ph tt">grains</tt> and pass options to it:
                              </p>
                              <pre class="pre codeblock language-yaml">grains:
  roles:
    - webserver
    - memcache
  deployment: datacenter4
  cabinet: 13
  cab_u: 14-15</pre>
                              <p class="p">Then status data specific to your servers can be retrieved via Salt, or used
                                 inside of the State system for matching. It also makes targeting, in the case
                                 of the example above, simply based on specific data about your deployment.
                              </p>
                              
                           </div>
                           
                           <div class="section" id="grains__grains-in-etc-salt-grains">
                              <h2 class="title sectiontitle">Grains in /etc/salt/grains</h2>
                              <p class="p">If you do not want to place your custom static grains in the minion config
                                 file, you can also put them in <tt class="ph tt">/etc/salt/grains</tt> on the minion. They are configured in the
                                 same way as in the above example, only without a top-level <tt class="ph tt">grains:</tt> key:
                              </p>
                              <pre class="pre codeblock language-yaml">roles:
  - webserver
  - memcache
deployment: datacenter4
cabinet: 13
cab_u: 14-15</pre>
                              </div>
                           
                           <div class="section" id="grains__matching-grains-in-the-top-file">
                              <h2 class="title sectiontitle">Matching Grains in the Top File</h2>
                              <p class="p">With correctly configured grains on the Minion, the <a class="xref" href="unresolvable-reference.html#__term-top-file">top file</a> used in
                                 Pillar or during Highstate can be made very efficient. For example, consider
                                 the following configuration:
                              </p>
                              <pre class="pre codeblock language-yaml">'node_type:web':
  - match: grain
  - webserver

'node_type:postgres':
  - match: grain
  - database

'node_type:redis':
  - match: grain
  - redis

'node_type:lb':
  - match: grain
  - lb</pre>
                              <p class="p">For this example to work, you would need to have defined the grain
                                 <tt class="ph tt">node_type</tt> for the minions you wish to match. This simple example is nice,
                                 but too much of the code is similar. To go one step further, Jinja templating
                                 can be used to simplify the <a class="xref" href="unresolvable-reference.html#__term-top-file">top file</a>.
                              </p>
                              <pre class="pre codeblock language-yaml">{% set node_type = salt['grains.get']('node_type', '') %}

{% if node_type %}
  'node_type:{{ self }}':
    - match: grain
    - {{ self }}
{% endif %}</pre>
                              <p class="p">Using Jinja templating, only one match entry needs to be defined.</p>
                              
                              <aside class="note "><span class="title">Note:</span> 
                                 <p class="p">The example above uses the <a class="xref" href="unresolvable-reference.html#module-salt.modules.grains__salt.modules.grains.get">grains.get</a>
                                    function to account for minions which do not have the <tt class="ph tt">node_type</tt> grain
                                    set.
                                 </p>
                                 
                              </aside>
                              
                           </div>
                           
                           <div class="section" id="grains__writing-grains">
                              <h2 class="title sectiontitle">Writing Grains</h2>
                              <p class="p">The grains interface is derived by executing
                                 all of the "public" functions found in the modules located in the grains
                                 package or the custom grains directory. The functions in the modules of
                                 the grains must return a Python <a class="xref" href="http://docs.python.org/2/library/stdtypes.html#typesmapping" target="_blank">dict</a>, where the
                                 keys in the <a class="xref" href="http://docs.python.org/2/library/stdtypes.html#typesmapping" target="_blank">dict</a> are the names of the grains and
                                 the values are the values.
                              </p>
                              
                              <p class="p">Custom grains should be placed in a <tt class="ph tt">_grains</tt> directory located under the
                                 <a class="xref" href="unresolvable-reference.html#configuring-the-salt-master__std:conf_master-file_roots">file_roots</a> specified by the master config file.  The default path
                                 would be <tt class="ph tt">/srv/salt/_grains</tt>.  Custom grains will be
                                 distributed to the minions when <a class="xref" href="unresolvable-reference.html#module-salt.modules.state__salt.modules.state.highstate">state.highstate</a> is run, or by executing the
                                 <a class="xref" href="unresolvable-reference.html#module-salt.modules.saltutil__salt.modules.saltutil.sync_grains">saltutil.sync_grains</a> or
                                 <a class="xref" href="unresolvable-reference.html#module-salt.modules.saltutil__salt.modules.saltutil.sync_all">saltutil.sync_all</a> functions.
                              </p>
                              
                              <p class="p">Grains are easy to write, and only need to return a dictionary.  A common
                                 approach would be code something similar to the following:
                              </p>
                              <pre class="pre codeblock language-python">#!/usr/bin/env python
def yourfunction():
     # initialize a grains dictionary
     grains = {}
     # Some code for logic that sets grains like
     grains['yourcustomgrain']=True
     grains['anothergrain']='somevalue'
     return grains</pre>
                              <p class="p">Before adding a grain to Salt, consider what the grain is and remember that
                                 grains need to be static data. If the data is something that is likely to
                                 change, consider using <a class="xref" href="unresolvable-reference.html#__">Pillar</a> instead.
                              </p>
                              
                              <p class="p">Custom grains will not be available in the top file until after the first
                                 <a class="xref" href="../tutorials/states_pt1.html#states-tutorial-part-1-basic-usage__running-highstate">highstate</a>. To make custom grains available on a
                                 minion's first highstate, it is recommended to use <a class="xref" href="../reactor/index.html#reactor-system__minion-start-reactor">this example</a> to ensure that the custom grains are synced when
                                 the minion starts.
                              </p>
                              
                           </div>
                           
                           <div class="section" id="grains__precedence">
                              <h2 class="title sectiontitle">Precedence</h2>
                              <p class="p">Core grains can be overridden by custom grains. As there are several ways of
                                 defining custom grains, there is an order of precedence which should be kept in
                                 mind when defining them. The order of evaluation is as follows:
                              </p>
                              
                              <ol class="ol">
                                 <li class="li">
                                    <p class="p">Core grains.</p>
                                    
                                 </li>
                                 
                                 <li class="li">
                                    <p class="p">Custom grains in <tt class="ph tt">/etc/salt/grains</tt>.
                                    </p>
                                    
                                 </li>
                                 
                                 <li class="li">
                                    <p class="p">Custom grains in <tt class="ph tt">/etc/salt/minion</tt>.
                                    </p>
                                    
                                 </li>
                                 
                                 <li class="li">
                                    <p class="p">Custom grain modules in <tt class="ph tt">_grains</tt> directory, synced to minions.
                                    </p>
                                    
                                 </li>
                                 
                              </ol>
                              
                              <p class="p">Each successive evaluation overrides the previous ones, so any grains defined
                                 in <tt class="ph tt">/etc/salt/grains</tt> that have the same name as a core grain will override
                                 that core grain. Similarly, <tt class="ph tt">/etc/salt/minion</tt> overrides both core grains and
                                 grains set in <tt class="ph tt">/etc/salt/grains</tt>, and custom grain modules will override
                                 <em class="ph i">any</em> grains of the same name.
                              </p>
                              
                           </div>
                           
                           <div class="section" id="grains__examples-of-grains">
                              <h2 class="title sectiontitle">Examples of Grains</h2>
                              <p class="p">The core module in the grains package is where the main grains are loaded by
                                 the Salt minion and provides the principal example of how to write grains:
                              </p>
                              
                              <p class="p"><a class="xref" href="https://github.com/saltstack/salt/blob/develop/salt/grains/core.py" target="_blank">https://github.com/saltstack/salt/blob/develop/salt/grains/core.py</a></p>
                              
                           </div>
                           
                           <div class="section" id="grains__syncing-grains">
                              <h2 class="title sectiontitle">Syncing Grains</h2>
                              <p class="p">Syncing grains can be done a number of ways, they are automatically synced when
                                 <a class="xref" href="unresolvable-reference.html#module-salt.modules.state__salt.modules.state.highstate">state.highstate</a> is called, or (as noted
                                 above) the grains can be manually synced and reloaded by calling the
                                 <a class="xref" href="unresolvable-reference.html#module-salt.modules.saltutil__salt.modules.saltutil.sync_grains">saltutil.sync_grains</a> or
                                 <a class="xref" href="unresolvable-reference.html#module-salt.modules.saltutil__salt.modules.saltutil.sync_all">saltutil.sync_all</a> functions.
                              </p>
                              
                           </div>
                           
                        </div>
                        
                        <div xmlns:htmlutil="http://dita4publishers.org/functions/htmlutil" class="related-links"></div>
                     </div>
                     <button id="next-button" type="button" class="btn btn-primary">
                        Next <span class="glyphicon glyphicon-chevron-right"></span></button><div class="footer">
                        <p class="text-muted pull-right"><small>Copyright © 2015 SaltStack.</small></p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </body>
</html>
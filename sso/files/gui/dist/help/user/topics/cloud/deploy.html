<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <title>OS Support for Cloud VMs</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="schema.DC" href="http://purl.org/dc/terms/">
      <meta name="DC.Type" content="concept">
      
      <meta name="DC.Title" content="OS Support for Cloud VMs">
      
      <meta name="DC.Relation" scheme="URI" content="index.html">
      
      <meta name="DC.Format" content="XHTML">
      
      <meta name="DC.Identifier" content="os-support-for-cloud-vms">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/bootstrap.min.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/fonts.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/prism.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/lightbox.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/webhelp.css">
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery-1.11.0.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery-ui-1.9.1.custom.min.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery.slimscroll.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery.tocify.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/prism.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/lightbox.min.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/webhelp.js"></script>
      </head>
   <body>
      <div id="wrapper">
         <div id="sidebar-wrapper"><a class="ss-logo" href="/help/home.html"></a><div id="search-form" class="inner-addon left-addon"><i class="glyphicon glyphicon-search"></i><input type="text" class="form-control"></div>
            <div id="guide-links">
               <div class="well">
                  <ul class="nav nav-pills nav-stacked">
                     <li><a href="/help/gs/index.html"><span class="glyphicon glyphicon glyphicon-th-list"></span> Get Started</a></li>
                     <li><a href="/help/home.html"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
                     <li><a href="/help/enterprise/user-guide.html"><span class="glyphicon glyphicon-user"></span> User Guide</a></li>
                  </ul>
               </div>
               <p id="guide-title">Enterprise Help</p>
            </div>
            <div class="sidebar-nav">
               <ul id="gen-links">
                  <li class=" collapsible  collapsed"><a href="../../../enterprise/use-cases.html">Use Cases</a><ul>
                        <li class=" no-child "><a href="../../../enterprise/continuous-deployment.html">Continuous Deployment</a></li>
                        <li class=" no-child "><a href="../../../enterprise/app-stacks.html">Application Stacks</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../enterprise/cloud.html">Cloud Management</a><ul>
                              <li class=" no-child "><a href="../../../enterprise/orchestrate.html">Orchestration</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../enterprise/security-bp.html">Security Best Practices</a></li>
                        <li class=" no-child "><a href="../../../enterprise/components.html">SaltStack Components</a></li>
                     </ul>
                  </li>
                  <li class=" collapsible  collapsed"><a href="../../../enterprise/deployment.html">Deployment</a><ul>
                        <li class=" no-child "><a href="../../../enterprise/t_ops_prepare.html">Preparing the SaltStack Ops System</a></li>
                        <li class=" no-child "><a href="../../../enterprise/t_master_prepare.html">Preparing Masters for SaltStack Ops Integration</a></li>
                        <li class=" no-child "><a href="../../../enterprise/requirements.html">System Requirements</a></li>
                        <li class=" no-child "><a href="../../../enterprise/faq.html">Frequently Asked Questions</a></li>
                     </ul>
                  </li>
                  <li class=" no-child "><a href="../../../enterprise/masters.html">View Masters</a></li>
                  <li class=" no-child "><a href="../../../enterprise/minions.html">View Minions</a></li>
                  <li class=" no-child "><a href="../../../enterprise/jobs.html">Jobs</a></li>
                  <li class=" no-child "><a href="../../../enterprise/targets.html">Targets</a></li>
                  <li class=" collapsible  collapsed"><a href="../../../enterprise/management.html">Admin Management</a><ul>
                        <li class=" no-child "><a href="../../../enterprise/cfg-masters.html">Manage Masters</a></li>
                        <li class=" no-child "><a href="../../../enterprise/jobs-all.html">Manage Jobs</a></li>
                        <li class=" no-child "><a href="../../../enterprise/cfg-users.html">User Accounts</a></li>
                     </ul>
                  </li>
                  <li class=" no-child "><a href="../../../enterprise/web-console-overview.html">Console Overview</a></li>
                  <li class=" no-child "><a href="../../../enterprise/reports.html">View Reports</a></li>
                  <li class=" no-child "><a href="../../../enterprise/architecture.html">Architecture Reference</a></li>
                  <li class=" no-child "><a href="../../../enterprise/glossary.html">Glossary</a></li>
                  <li class=" collapsible  active"><a href="../../../enterprise/user-guide.html">SaltStack User Guide</a><ul>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/installation/index.html">Installation</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/installation/debian.html">Debian Installation</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/freebsd.html">FreeBSD</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/gentoo.html">Gentoo</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/solaris.html">Solaris</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/ubuntu.html">Ubuntu Installation</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/windows.html">Windows</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/tutorials/index.html">Tutorials</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/standalone_minion.html">Standalone Minion</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/cron.html">Using cron with Salt</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/states_pt1.html">States tutorial, part 1 - Basic Usage</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/states_pt2.html">States tutorial, part 2 - More Complex States, Requisites</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/states_pt4.html">States tutorial, part 4</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/minionfs.html">MinionFS Backend Walkthrough</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/multimaster_pki.html">Multi-Master-PKI Tutorial With Failover</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/writing_tests.html">Writing Salt Tests</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/halite.html">Installing and Configuring Halite</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/targeting/index.html">Targeting Minions</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/targeting/globbing.html">Matching the minion id</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/grains.html">Grains</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/ipcidr.html">Subnet/IP Address Matching</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/compound.html">Compound matchers</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/nodegroups.html">Node groups</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/batch.html">Batch Size</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/range.html">SECO Range</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../user/topics/pillar/index.html">Storing Static Data in the Pillar</a></li>
                        <li class=" no-child "><a href="../../../user/topics/reactor/index.html">Reactor System</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/eauth/index.html">External Authentication System</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/eauth/access_control.html">Access Control System</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/event/index.html">Salt Event System</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/event/master_events.html">Salt Master Events</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../user/topics/topology/syndic.html">Salt Syndic</a></li>
                        <li class=" no-child "><a href="../../../user/topics/topology/proxyminion/index.html">Proxy Minion</a></li>
                        <li class=" no-child "><a href="../../../user/topics/windows/windows-specific-behavior.html">Windows-specific Behaviour</a></li>
                        <li class=" collapsible  active"><a href="../../../user/topics/cloud/index.html">Salt Cloud</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/cloud/basic.html">Salt Cloud basic usage</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/profiles.html">VM Profiles</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/map.html">Cloud Map File</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/action.html">Cloud Actions</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/function.html">Cloud Functions</a></li>
                              <li class=" collapsible  collapsed"><a href="../../../user/topics/cloud/provider-specifics.html">Cloud Provider Specifics</a><ul>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/parallels.html">Getting Started With Parallels</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/proxmox.html">Getting Started With Proxmox</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/lxc.html">Getting Started With LXC</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/hpcloud.html">Getting Started With HP Cloud</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/vexxhost.html">Getting Started with VEXXHOST</a></li>
                                 </ul>
                              </li>
                              <li class=" no-child  active">
                                 <div id="toc"></div>
                              </li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/features.html">Feature Matrix</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/windows.html">Spinning up Windows Minions</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/netapi/index.html">netapi modules</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/netapi/writing.html">Writing netapi modules</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/virt/index.html">Salt Virt</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/virt/disk.html">Virtual Machine Disk Profiles</a></li>
                              <li class=" no-child "><a href="../../../user/topics/virt/nic.html">Virtual Machine Network Profiles</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../user/topics/yaml/index.html">Understanding YAML</a></li>
                        <li class=" no-child "><a href="../../../user/topics/master_tops/index.html">Master Tops System</a></li>
                        <li class=" no-child "><a href="../../../user/topics/best_practices.html">Salt Best Practices</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/troubleshooting/index.html">Troubleshooting</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/troubleshooting/minion.html">Troubleshooting the Salt Minion</a></li>
                           </ul>
                        </li>
                     </ul>
                  </li>
               </ul>
            </div>
         </div>
         <div id="page-content-wrapper">
            <div class="container-fluid">
               <div class="row">
                  <div class="col-lg-12">
                     <div class="page concept  - topic-topic concept-concept " id="os-support-for-cloud-vms">
                        
                        <h1 class="title topictitle1">OS Support for Cloud VMs</h1>
                        <div class="body conbody">
                           <p class="p">Salt Cloud works primarily by executing a script on the virtual machines as
                              soon as they become available. The script that is executed is referenced in the
                              cloud profile as the <tt class="ph tt">script</tt>. In older versions, this was the <tt class="ph tt">os</tt>
                              argument. This was changed in 0.8.2.
                           </p>
                           
                           <p class="p">A number of legacy scripts exist in the deploy directory in the saltcloud
                              source tree. The preferred method is currently to use the salt-bootstrap
                              script. A stable version is included with each release tarball starting with
                              0.8.4. The most updated version can be found at:
                           </p>
                           
                           <p class="p"><a class="xref" href="https://github.com/saltstack/salt-bootstrap" target="_blank">https://github.com/saltstack/salt-bootstrap</a></p>
                           
                           <p class="p">If you do not specify a script argument, this script will be used at the
                              default.
                           </p>
                           
                           <p class="p">If the Salt Bootstrap script does not meet your needs, you may write your own.
                              The script should be written in bash and is a Jinja template. Deploy scripts
                              need to execute a number of functions to do a complete salt setup. These
                              functions include:
                           </p>
                           
                           <ol class="ol">
                              <li class="li">
                                 <p class="p">Install the salt minion. If this can be done via system packages this method
                                    is HIGHLY preferred.
                                 </p>
                                 
                              </li>
                              
                              <li class="li">
                                 <p class="p">Add the salt minion keys before the minion is started for the first time.
                                    The minion keys are available as strings that can be copied into place in
                                    the Jinja template under the dict named "vm".
                                 </p>
                                 
                              </li>
                              
                              <li class="li">
                                 <p class="p">Start the salt-minion daemon and enable it at startup time.</p>
                                 
                              </li>
                              
                              <li class="li">
                                 <p class="p">Set up the minion configuration file from the "minion" data available in
                                    the Jinja template.
                                 </p>
                                 
                              </li>
                              
                           </ol>
                           
                           <p class="p">A good, well commented, example of this process is the Fedora deployment
                              script:
                           </p>
                           
                           <p class="p"><a class="xref" href="https://github.com/saltstack/salt-cloud/blob/master/saltcloud/deploy/Fedora.sh" target="_blank">https://github.com/saltstack/salt-cloud/blob/master/saltcloud/deploy/Fedora.sh</a></p>
                           
                           <p class="p">A number of legacy deploy scripts are included with the release tarball. None
                              of them are as functional or complete as Salt Bootstrap, and are still included
                              for academic purposes.
                           </p>
                           
                           <div class="section" id="os-support-for-cloud-vms__other-generic-deploy-scripts">
                              <h2 class="title sectiontitle">Other Generic Deploy Scripts</h2>
                              <p class="p">If you want to be assured of always using the latest Salt Bootstrap script,
                                 there are a few generic templates available in the deploy directory of your
                                 saltcloud source tree:
                              </p>
                              <pre class="pre codeblock language-bash">curl-bootstrap
curl-bootstrap-git
python-bootstrap
wget-bootstrap
wget-bootstrap-git</pre>
                              <p class="p">These are example scripts which were designed to be customized, adapted, and
                                 refit to meet your needs. One important use of them is to pass options to
                                 the salt-bootstrap script, such as updating to specific git tags.
                              </p>
                              
                           </div>
                           
                           <div class="section" id="os-support-for-cloud-vms__post-deploy-commands">
                              <h2 class="title sectiontitle">Post-Deploy Commands</h2>
                              <p class="p">Once a minion has been deployed, it has the option to run a salt command.
                                 Normally, this would be the state.highstate command, which would finish
                                 provisioning the VM. Another common option is state.sls, or for just testing,
                                 test.ping. This is configured in the main cloud config file:
                              </p>
                              <pre class="pre codeblock language-yaml">start_action: state.highstate</pre>
                              <p class="p">This is currently considered to be experimental functionality, and may not work
                                 well with all providers. If you experience problems with Salt Cloud hanging
                                 after Salt is deployed, consider using Startup States instead:
                              </p>
                              
                              <p class="p"><a class="xref" href="http://docs.saltstack.com/ref/states/startup.html" target="_blank">http://docs.saltstack.com/ref/states/startup.html</a></p>
                              
                           </div>
                           
                           <div class="section" id="os-support-for-cloud-vms__skipping-the-deploy-script">
                              <h2 class="title sectiontitle">Skipping the Deploy Script</h2>
                              <p class="p">For whatever reason, you may want to skip the deploy script altogether. This
                                 results in a VM being spun up much faster, with absolutely no configuration.
                                 This can be set from the command line:
                              </p>
                              <pre class="pre codeblock language-bash">salt-cloud --no-deploy -p micro_aws my_instance</pre>
                              <p class="p">Or it can be set from the main cloud config file:</p>
                              <pre class="pre codeblock language-yaml">deploy: False</pre>
                              <p class="p">Or it can be set from the provider's configuration:</p>
                              <pre class="pre codeblock language-yaml">RACKSPACE.user: example_user
RACKSPACE.apikey: 123984bjjas87034
RACKSPACE.deploy: False</pre>
                              <p class="p">Or even on the VM's profile settings:</p>
                              <pre class="pre codeblock language-yaml">ubuntu_aws:
  provider: aws
  image: ami-7e2da54e
  size: t1.micro
  deploy: False</pre>
                              <p class="p">The default for deploy is True.</p>
                              
                              <p class="p">In the profile, you may also set the script option to <tt class="ph tt">None</tt>:
                              </p>
                              <pre class="pre codeblock language-yaml">script: None</pre>
                              <p class="p">This is the slowest option, since it still uploads the None deploy script and
                                 executes it.
                              </p>
                              
                           </div>
                           
                           <div class="section" id="os-support-for-cloud-vms__updating-salt-bootstrap">
                              <h2 class="title sectiontitle">Updating Salt Bootstrap</h2>
                              <p class="p">Salt Bootstrap can be updated automatically with salt-cloud:</p>
                              <pre class="pre codeblock language-bash">salt-cloud -u
salt-cloud --update-bootstrap</pre>
                              <p class="p">Bear in mind that this updates to the latest (unstable) version, so use with
                                 caution.
                              </p>
                              
                           </div>
                           
                           <div class="section" id="os-support-for-cloud-vms__keeping-tmp-files">
                              <h2 class="title sectiontitle">Keeping /tmp/ Files</h2>
                              <p class="p">When Salt Cloud deploys an instance, it uploads temporary files to /tmp/ for
                                 salt-bootstrap to put in place. After the script has run, they are deleted. To
                                 keep these files around (mostly for debugging purposes), the --keep-tmp option
                                 can be added:
                              </p>
                              <pre class="pre codeblock language-bash">salt-cloud -p myprofile mymachine --keep-tmp</pre>
                              <p class="p">For those wondering why /tmp/ was used instead of /root/, this had to be done
                                 for images which require the use of sudo, and therefore do not allow remote
                                 root logins, even for file transfers (which makes /root/ unavailable).
                              </p>
                              
                           </div>
                           
                           <div class="section" id="os-support-for-cloud-vms__deploy-script-arguments">
                              <h2 class="title sectiontitle">Deploy Script Arguments</h2>
                              <p class="p">Custom deploy scripts are unlikely to need custom arguments to be passed to
                                 them, but salt-bootstrap has been extended quite a bit, and this may be
                                 necessary. script_args can be specified in either the profile or the map file,
                                 to pass arguments to the deploy script:
                              </p>
                              <pre class="pre codeblock language-yaml">aws-amazon:
    provider: aws
    image: ami-1624987f
    size: t1.micro
    ssh_username: ec2-user
    script: bootstrap-salt
    script_args: -c /tmp/</pre>
                              <p class="p">This has also been tested to work with pipes, if needed:</p>
                              <pre class="pre codeblock language-yaml">script_args: | head</pre>
                              </div>
                           
                        </div>
                        
                        <div xmlns:htmlutil="http://dita4publishers.org/functions/htmlutil" class="related-links"></div>
                     </div>
                     <button id="next-button" type="button" class="btn btn-primary">
                        Next <span class="glyphicon glyphicon-chevron-right"></span></button><div class="footer">
                        <p class="text-muted pull-right"><small>Copyright © 2015 SaltStack.</small></p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </body>
</html>
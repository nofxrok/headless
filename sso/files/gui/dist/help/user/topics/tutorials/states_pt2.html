<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <title>States tutorial, part 2 - More Complex States, Requisites</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="schema.DC" href="http://purl.org/dc/terms/">
      <meta name="DC.Type" content="concept">
      
      <meta name="DC.Title" content="States tutorial, part 2 - More Complex States, Requisites">
      
      <meta name="DC.Relation" scheme="URI" content="index.html">
      
      <meta name="DC.Format" content="XHTML">
      
      <meta name="DC.Identifier" content="states-tutorial-part-2-more-complex-states-requisites">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/bootstrap.min.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/fonts.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/prism.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/lightbox.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/webhelp.css">
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery-1.11.0.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery-ui-1.9.1.custom.min.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery.slimscroll.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery.tocify.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/prism.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/lightbox.min.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/webhelp.js"></script>
      </head>
   <body>
      <div id="wrapper">
         <div id="sidebar-wrapper"><a class="ss-logo" href="/help/home.html"></a><div id="search-form" class="inner-addon left-addon"><i class="glyphicon glyphicon-search"></i><input type="text" class="form-control"></div>
            <div id="guide-links">
               <div class="well">
                  <ul class="nav nav-pills nav-stacked">
                     <li><a href="/help/gs/index.html"><span class="glyphicon glyphicon glyphicon-th-list"></span> Get Started</a></li>
                     <li><a href="/help/home.html"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
                     <li><a href="/help/enterprise/user-guide.html"><span class="glyphicon glyphicon-user"></span> User Guide</a></li>
                  </ul>
               </div>
               <p id="guide-title">Enterprise Help</p>
            </div>
            <div class="sidebar-nav">
               <ul id="gen-links">
                  <li class=" collapsible  collapsed"><a href="../../../enterprise/use-cases.html">Use Cases</a><ul>
                        <li class=" no-child "><a href="../../../enterprise/continuous-deployment.html">Continuous Deployment</a></li>
                        <li class=" no-child "><a href="../../../enterprise/app-stacks.html">Application Stacks</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../enterprise/cloud.html">Cloud Management</a><ul>
                              <li class=" no-child "><a href="../../../enterprise/orchestrate.html">Orchestration</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../enterprise/security-bp.html">Security Best Practices</a></li>
                        <li class=" no-child "><a href="../../../enterprise/components.html">SaltStack Components</a></li>
                     </ul>
                  </li>
                  <li class=" collapsible  collapsed"><a href="../../../enterprise/deployment.html">Deployment</a><ul>
                        <li class=" no-child "><a href="../../../enterprise/t_ops_prepare.html">Preparing the SaltStack Ops System</a></li>
                        <li class=" no-child "><a href="../../../enterprise/t_master_prepare.html">Preparing Masters for SaltStack Ops Integration</a></li>
                        <li class=" no-child "><a href="../../../enterprise/requirements.html">System Requirements</a></li>
                        <li class=" no-child "><a href="../../../enterprise/faq.html">Frequently Asked Questions</a></li>
                     </ul>
                  </li>
                  <li class=" no-child "><a href="../../../enterprise/masters.html">View Masters</a></li>
                  <li class=" no-child "><a href="../../../enterprise/minions.html">View Minions</a></li>
                  <li class=" no-child "><a href="../../../enterprise/jobs.html">Jobs</a></li>
                  <li class=" no-child "><a href="../../../enterprise/targets.html">Targets</a></li>
                  <li class=" collapsible  collapsed"><a href="../../../enterprise/management.html">Admin Management</a><ul>
                        <li class=" no-child "><a href="../../../enterprise/cfg-masters.html">Manage Masters</a></li>
                        <li class=" no-child "><a href="../../../enterprise/jobs-all.html">Manage Jobs</a></li>
                        <li class=" no-child "><a href="../../../enterprise/cfg-users.html">User Accounts</a></li>
                     </ul>
                  </li>
                  <li class=" no-child "><a href="../../../enterprise/web-console-overview.html">Console Overview</a></li>
                  <li class=" no-child "><a href="../../../enterprise/reports.html">View Reports</a></li>
                  <li class=" no-child "><a href="../../../enterprise/architecture.html">Architecture Reference</a></li>
                  <li class=" no-child "><a href="../../../enterprise/glossary.html">Glossary</a></li>
                  <li class=" collapsible  active"><a href="../../../enterprise/user-guide.html">SaltStack User Guide</a><ul>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/installation/index.html">Installation</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/installation/debian.html">Debian Installation</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/freebsd.html">FreeBSD</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/gentoo.html">Gentoo</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/solaris.html">Solaris</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/ubuntu.html">Ubuntu Installation</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/windows.html">Windows</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  active"><a href="../../../user/topics/tutorials/index.html">Tutorials</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/standalone_minion.html">Standalone Minion</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/cron.html">Using cron with Salt</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/states_pt1.html">States tutorial, part 1 - Basic Usage</a></li>
                              <li class=" no-child  active">
                                 <div id="toc"></div>
                              </li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/states_pt4.html">States tutorial, part 4</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/minionfs.html">MinionFS Backend Walkthrough</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/multimaster_pki.html">Multi-Master-PKI Tutorial With Failover</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/writing_tests.html">Writing Salt Tests</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/halite.html">Installing and Configuring Halite</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/targeting/index.html">Targeting Minions</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/targeting/globbing.html">Matching the minion id</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/grains.html">Grains</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/ipcidr.html">Subnet/IP Address Matching</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/compound.html">Compound matchers</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/nodegroups.html">Node groups</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/batch.html">Batch Size</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/range.html">SECO Range</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../user/topics/pillar/index.html">Storing Static Data in the Pillar</a></li>
                        <li class=" no-child "><a href="../../../user/topics/reactor/index.html">Reactor System</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/eauth/index.html">External Authentication System</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/eauth/access_control.html">Access Control System</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/event/index.html">Salt Event System</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/event/master_events.html">Salt Master Events</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../user/topics/topology/syndic.html">Salt Syndic</a></li>
                        <li class=" no-child "><a href="../../../user/topics/topology/proxyminion/index.html">Proxy Minion</a></li>
                        <li class=" no-child "><a href="../../../user/topics/windows/windows-specific-behavior.html">Windows-specific Behaviour</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/cloud/index.html">Salt Cloud</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/cloud/basic.html">Salt Cloud basic usage</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/profiles.html">VM Profiles</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/map.html">Cloud Map File</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/action.html">Cloud Actions</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/function.html">Cloud Functions</a></li>
                              <li class=" collapsible  collapsed"><a href="../../../user/topics/cloud/provider-specifics.html">Cloud Provider Specifics</a><ul>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/parallels.html">Getting Started With Parallels</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/proxmox.html">Getting Started With Proxmox</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/lxc.html">Getting Started With LXC</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/hpcloud.html">Getting Started With HP Cloud</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/vexxhost.html">Getting Started with VEXXHOST</a></li>
                                 </ul>
                              </li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/deploy.html">OS Support for Cloud VMs</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/features.html">Feature Matrix</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/windows.html">Spinning up Windows Minions</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/netapi/index.html">netapi modules</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/netapi/writing.html">Writing netapi modules</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/virt/index.html">Salt Virt</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/virt/disk.html">Virtual Machine Disk Profiles</a></li>
                              <li class=" no-child "><a href="../../../user/topics/virt/nic.html">Virtual Machine Network Profiles</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../user/topics/yaml/index.html">Understanding YAML</a></li>
                        <li class=" no-child "><a href="../../../user/topics/master_tops/index.html">Master Tops System</a></li>
                        <li class=" no-child "><a href="../../../user/topics/best_practices.html">Salt Best Practices</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/troubleshooting/index.html">Troubleshooting</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/troubleshooting/minion.html">Troubleshooting the Salt Minion</a></li>
                           </ul>
                        </li>
                     </ul>
                  </li>
               </ul>
            </div>
         </div>
         <div id="page-content-wrapper">
            <div class="container-fluid">
               <div class="row">
                  <div class="col-lg-12">
                     <div class="page concept  - topic-topic concept-concept " id="states-tutorial-part-2-more-complex-states-requisites">
                        
                        <h1 class="title topictitle1">States tutorial, part 2 - More Complex States, Requisites</h1>
                        <div class="body conbody">
                           <aside class="note "><span class="title">Note:</span> 
                              <p class="p">This tutorial builds on topics covered in <a class="xref" href="unresolvable-reference.html#__">part 1</a>. It is
                                 recommended that you begin there.
                              </p>
                              
                           </aside>
                           
                           <p class="p">In the <a class="xref" href="unresolvable-reference.html#__">last part</a> of the Salt States tutorial we covered the
                              basics of installing a package. We will now modify our <tt class="ph tt">webserver.sls</tt> file
                              to have requirements, and use even more Salt States.
                           </p>
                           
                           <div class="section" id="states-tutorial-part-2-more-complex-states-requisites__call-multiple-states">
                              <h2 class="title sectiontitle">Call multiple States</h2>
                              <p class="p">You can specify multiple <a class="xref" href="unresolvable-reference.html#highstate-data-structure-definitions__state-declaration">State declaration</a> under an
                                 <a class="xref" href="unresolvable-reference.html#highstate-data-structure-definitions__id-declaration">ID declaration</a>. For example, a quick modification to our
                                 <tt class="ph tt">webserver.sls</tt> to also start Apache if it is not running:
                              </p>
                              <pre class="pre codeblock language-yaml">apache:
  pkg.installed: []
  service.running:
    - require:
      - pkg: apache</pre>
                              <p class="p">Try stopping Apache before running <tt class="ph tt">state.highstate</tt> once again and observe
                                 the output.
                              </p>
                              
                           </div>
                           
                           <div class="section" id="states-tutorial-part-2-more-complex-states-requisites__require-other-states">
                              <h2 class="title sectiontitle">Require other states</h2>
                              <p class="p">We now have a working installation of Apache so let's add an HTML file to
                                 customize our website. It isn't exactly useful to have a website without a
                                 webserver so we don't want Salt to install our HTML file until Apache is
                                 installed and running. Include the following at the bottom of your
                                 <tt class="ph tt">webserver/init.sls</tt> file:
                              </p>
                              <pre class="pre codeblock language-yaml">apache:
  pkg.installed: []
  service.running:
    - require:
      - pkg: apache

/var/www/index.html:                        # ID declaration
  file:                                     # state declaration
    - managed                               # function
    - source: salt://webserver/index.html   # function arg
    - require:                              # requisite declaration
      - pkg: apache                         # requisite reference</pre>
                              <p class="p"><strong class="ph b">line 7</strong> is the <a class="xref" href="unresolvable-reference.html#highstate-data-structure-definitions__id-declaration">ID declaration</a>. In this example it is the location we
                                 want to install our custom HTML file. (<strong class="ph b">Note:</strong> the default location that
                                 Apache serves may differ from the above on your OS or distro. <tt class="ph tt">/srv/www</tt>
                                 could also be a likely place to look.)
                              </p>
                              
                              <p class="p"><strong class="ph b">Line 8</strong> the <a class="xref" href="unresolvable-reference.html#highstate-data-structure-definitions__state-declaration">State declaration</a>. This example uses the Salt <a class="xref" href="unresolvable-reference.html#module-salt.states.file__module-salt.states.file">file
                                    state</a>.
                              </p>
                              
                              <p class="p"><strong class="ph b">Line 9</strong> is the <a class="xref" href="unresolvable-reference.html#highstate-data-structure-definitions__function-declaration">Function declaration</a>. The <a class="xref" href="unresolvable-reference.html#module-salt.states.file__salt.states.file.managed">managed function</a> will download a file from the master and install it
                                 in the location specified.
                              </p>
                              
                              <p class="p"><strong class="ph b">Line 10</strong> is a <a class="xref" href="unresolvable-reference.html#highstate-data-structure-definitions__function-arg-declaration">Function arg declaration</a> which, in this example, passes
                                 the <tt class="ph tt">source</tt> argument to the <a class="xref" href="unresolvable-reference.html#module-salt.states.file__salt.states.file.managed">managed function</a>.
                              </p>
                              
                              <p class="p"><strong class="ph b">Line 11</strong> is a <a class="xref" href="unresolvable-reference.html#highstate-data-structure-definitions__requisite-declaration">Requisite declaration</a>.
                              </p>
                              
                              <p class="p"><strong class="ph b">Line 12</strong> is a <a class="xref" href="unresolvable-reference.html#highstate-data-structure-definitions__requisite-reference">Requisite reference</a> which refers to a state and an ID.
                                 In this example, it is referring to the <tt class="ph tt">ID declaration</tt> from our example in
                                 <a class="xref" href="unresolvable-reference.html#__">part 1</a>. This declaration tells Salt not to install the HTML
                                 file until Apache is installed.
                              </p>
                              
                              <p class="p">Next, create the <tt class="ph tt">index.html</tt> file and save it in the <tt class="ph tt">webserver</tt>
                                 directory:
                              </p>
                              <pre class="pre codeblock language-html">&lt;!DOCTYPE html&gt;
&lt;html&gt;
    &lt;head&gt;&lt;title&gt;Salt rocks&lt;/title&gt;&lt;/head&gt;
    &lt;body&gt;
        &lt;h1&gt;This file brought to you by Salt&lt;/h1&gt;
    &lt;/body&gt;
&lt;/html&gt;</pre>
                              <p class="p">Last, call <a class="xref" href="unresolvable-reference.html#module-salt.modules.state__salt.modules.state.highstate">state.highstate</a> again and the
                                 minion will fetch and execute the highstate as well as our HTML file from the
                                 master using Salt's File Server:
                              </p>
                              <pre class="pre codeblock language-bash">salt '*' state.highstate</pre>
                              <p class="p">Verify that Apache is now serving your custom HTML.</p>
                              
                              <p class="p">There are two <a class="xref" href="unresolvable-reference.html#highstate-data-structure-definitions__requisite-declaration">Requisite declaration</a>, “require”, and “watch”. Not
                                 every state supports “watch”. The <a class="xref" href="unresolvable-reference.html#module-salt.states.service__module-salt.states.service">service state</a> does support “watch” and will restart a service
                                 based on the watch condition.
                              </p>
                              
                              <p class="p">For example, if you use Salt to install an Apache virtual host
                                 configuration file and want to restart Apache whenever that file is changed
                                 you could modify our Apache example from earlier as follows:
                              </p>
                              <pre class="pre codeblock language-yaml">/etc/httpd/extra/httpd-vhosts.conf:
  file.managed:
    - source: salt://webserver/httpd-vhosts.conf

apache:
  pkg.installed: []
  service.running:
    - watch:
      - file: /etc/httpd/extra/httpd-vhosts.conf
    - require:
      - pkg: apache</pre>
                              <p class="p">If the pkg and service names differ on your OS or distro of choice you can
                                 specify each one separately using a <a class="xref" href="unresolvable-reference.html#highstate-data-structure-definitions__name-declaration">Name declaration</a> which explained
                                 in <a class="xref" href="unresolvable-reference.html#__">Part 3</a>.
                              </p>
                              
                           </div>
                           
                           <div class="section" id="states-tutorial-part-2-more-complex-states-requisites__next-steps">
                              <h2 class="title sectiontitle">Next steps</h2>
                              <p class="p">In <a class="xref" href="unresolvable-reference.html#__">part 3</a> we will discuss how to use includes, extends, and
                                 templating to make a more complete State Tree configuration.
                              </p>
                              
                           </div>
                           
                        </div>
                        
                        <div xmlns:htmlutil="http://dita4publishers.org/functions/htmlutil" class="related-links"></div>
                     </div>
                     <button id="next-button" type="button" class="btn btn-primary">
                        Next <span class="glyphicon glyphicon-chevron-right"></span></button><div class="footer">
                        <p class="text-muted pull-right"><small>Copyright © 2015 SaltStack.</small></p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </body>
</html>
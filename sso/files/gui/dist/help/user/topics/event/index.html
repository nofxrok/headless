<!DOCTYPE html
  SYSTEM "about:legacy-compat">
<html lang="en-us">
   <head>
      <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
      <title>Salt Event System</title>
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width, initial-scale=1.0">
      <link rel="schema.DC" href="http://purl.org/dc/terms/">
      <meta name="DC.Type" content="concept">
      
      <meta name="DC.Title" content="Salt Event System">
      
      <meta name="DC.Relation" scheme="URI" content="../../../enterprise/user-guide.html">
      
      <meta name="DC.Relation" scheme="URI" content="master_events.html">
      
      <meta name="DC.Format" content="XHTML">
      
      <meta name="DC.Identifier" content="salt-event-system">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/bootstrap.min.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/fonts.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/prism.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/lightbox.css">
      
      <link rel="stylesheet" type="text/css" media="screen, projection" href="../../../themes/bootstrap/css/webhelp.css">
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery-1.11.0.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery-ui-1.9.1.custom.min.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/bootstrap.min.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery.slimscroll.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/jquery.tocify.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/prism.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/lightbox.min.js"></script>
      <script type="text/javascript" src="../../../themes/bootstrap/js/webhelp.js"></script>
      </head>
   <body>
      <div id="wrapper">
         <div id="sidebar-wrapper"><a class="ss-logo" href="/help/home.html"></a><div id="search-form" class="inner-addon left-addon"><i class="glyphicon glyphicon-search"></i><input type="text" class="form-control"></div>
            <div id="guide-links">
               <div class="well">
                  <ul class="nav nav-pills nav-stacked">
                     <li><a href="/help/gs/index.html"><span class="glyphicon glyphicon glyphicon-th-list"></span> Get Started</a></li>
                     <li><a href="/help/home.html"><span class="glyphicon glyphicon-home"></span>  Home</a></li>
                     <li><a href="/help/enterprise/user-guide.html"><span class="glyphicon glyphicon-user"></span> User Guide</a></li>
                  </ul>
               </div>
               <p id="guide-title">Enterprise Help</p>
            </div>
            <div class="sidebar-nav">
               <ul id="gen-links">
                  <li class=" collapsible  collapsed"><a href="../../../enterprise/use-cases.html">Use Cases</a><ul>
                        <li class=" no-child "><a href="../../../enterprise/continuous-deployment.html">Continuous Deployment</a></li>
                        <li class=" no-child "><a href="../../../enterprise/app-stacks.html">Application Stacks</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../enterprise/cloud.html">Cloud Management</a><ul>
                              <li class=" no-child "><a href="../../../enterprise/orchestrate.html">Orchestration</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../enterprise/security-bp.html">Security Best Practices</a></li>
                        <li class=" no-child "><a href="../../../enterprise/components.html">SaltStack Components</a></li>
                     </ul>
                  </li>
                  <li class=" collapsible  collapsed"><a href="../../../enterprise/deployment.html">Deployment</a><ul>
                        <li class=" no-child "><a href="../../../enterprise/t_ops_prepare.html">Preparing the SaltStack Ops System</a></li>
                        <li class=" no-child "><a href="../../../enterprise/t_master_prepare.html">Preparing Masters for SaltStack Ops Integration</a></li>
                        <li class=" no-child "><a href="../../../enterprise/requirements.html">System Requirements</a></li>
                        <li class=" no-child "><a href="../../../enterprise/faq.html">Frequently Asked Questions</a></li>
                     </ul>
                  </li>
                  <li class=" no-child "><a href="../../../enterprise/masters.html">View Masters</a></li>
                  <li class=" no-child "><a href="../../../enterprise/minions.html">View Minions</a></li>
                  <li class=" no-child "><a href="../../../enterprise/jobs.html">Jobs</a></li>
                  <li class=" no-child "><a href="../../../enterprise/targets.html">Targets</a></li>
                  <li class=" collapsible  collapsed"><a href="../../../enterprise/management.html">Admin Management</a><ul>
                        <li class=" no-child "><a href="../../../enterprise/cfg-masters.html">Manage Masters</a></li>
                        <li class=" no-child "><a href="../../../enterprise/jobs-all.html">Manage Jobs</a></li>
                        <li class=" no-child "><a href="../../../enterprise/cfg-users.html">User Accounts</a></li>
                     </ul>
                  </li>
                  <li class=" no-child "><a href="../../../enterprise/web-console-overview.html">Console Overview</a></li>
                  <li class=" no-child "><a href="../../../enterprise/reports.html">View Reports</a></li>
                  <li class=" no-child "><a href="../../../enterprise/architecture.html">Architecture Reference</a></li>
                  <li class=" no-child "><a href="../../../enterprise/glossary.html">Glossary</a></li>
                  <li class=" collapsible  active"><a href="../../../enterprise/user-guide.html">SaltStack User Guide</a><ul>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/installation/index.html">Installation</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/installation/debian.html">Debian Installation</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/freebsd.html">FreeBSD</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/gentoo.html">Gentoo</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/solaris.html">Solaris</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/ubuntu.html">Ubuntu Installation</a></li>
                              <li class=" no-child "><a href="../../../user/topics/installation/windows.html">Windows</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/tutorials/index.html">Tutorials</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/standalone_minion.html">Standalone Minion</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/cron.html">Using cron with Salt</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/states_pt1.html">States tutorial, part 1 - Basic Usage</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/states_pt2.html">States tutorial, part 2 - More Complex States, Requisites</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/states_pt4.html">States tutorial, part 4</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/minionfs.html">MinionFS Backend Walkthrough</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/multimaster_pki.html">Multi-Master-PKI Tutorial With Failover</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/writing_tests.html">Writing Salt Tests</a></li>
                              <li class=" no-child "><a href="../../../user/topics/tutorials/halite.html">Installing and Configuring Halite</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/targeting/index.html">Targeting Minions</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/targeting/globbing.html">Matching the minion id</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/grains.html">Grains</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/ipcidr.html">Subnet/IP Address Matching</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/compound.html">Compound matchers</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/nodegroups.html">Node groups</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/batch.html">Batch Size</a></li>
                              <li class=" no-child "><a href="../../../user/topics/targeting/range.html">SECO Range</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../user/topics/pillar/index.html">Storing Static Data in the Pillar</a></li>
                        <li class=" no-child "><a href="../../../user/topics/reactor/index.html">Reactor System</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/eauth/index.html">External Authentication System</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/eauth/access_control.html">Access Control System</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  active">
                           <div id="toc"></div>
                           <ul>
                              <li class=" no-child "><a href="../../../user/topics/event/master_events.html">Salt Master Events</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../user/topics/topology/syndic.html">Salt Syndic</a></li>
                        <li class=" no-child "><a href="../../../user/topics/topology/proxyminion/index.html">Proxy Minion</a></li>
                        <li class=" no-child "><a href="../../../user/topics/windows/windows-specific-behavior.html">Windows-specific Behaviour</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/cloud/index.html">Salt Cloud</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/cloud/basic.html">Salt Cloud basic usage</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/profiles.html">VM Profiles</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/map.html">Cloud Map File</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/action.html">Cloud Actions</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/function.html">Cloud Functions</a></li>
                              <li class=" collapsible  collapsed"><a href="../../../user/topics/cloud/provider-specifics.html">Cloud Provider Specifics</a><ul>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/parallels.html">Getting Started With Parallels</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/proxmox.html">Getting Started With Proxmox</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/lxc.html">Getting Started With LXC</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/hpcloud.html">Getting Started With HP Cloud</a></li>
                                    <li class=" no-child "><a href="../../../user/topics/cloud/vexxhost.html">Getting Started with VEXXHOST</a></li>
                                 </ul>
                              </li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/deploy.html">OS Support for Cloud VMs</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/features.html">Feature Matrix</a></li>
                              <li class=" no-child "><a href="../../../user/topics/cloud/windows.html">Spinning up Windows Minions</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/netapi/index.html">netapi modules</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/netapi/writing.html">Writing netapi modules</a></li>
                           </ul>
                        </li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/virt/index.html">Salt Virt</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/virt/disk.html">Virtual Machine Disk Profiles</a></li>
                              <li class=" no-child "><a href="../../../user/topics/virt/nic.html">Virtual Machine Network Profiles</a></li>
                           </ul>
                        </li>
                        <li class=" no-child "><a href="../../../user/topics/yaml/index.html">Understanding YAML</a></li>
                        <li class=" no-child "><a href="../../../user/topics/master_tops/index.html">Master Tops System</a></li>
                        <li class=" no-child "><a href="../../../user/topics/best_practices.html">Salt Best Practices</a></li>
                        <li class=" collapsible  collapsed"><a href="../../../user/topics/troubleshooting/index.html">Troubleshooting</a><ul>
                              <li class=" no-child "><a href="../../../user/topics/troubleshooting/minion.html">Troubleshooting the Salt Minion</a></li>
                           </ul>
                        </li>
                     </ul>
                  </li>
               </ul>
            </div>
         </div>
         <div id="page-content-wrapper">
            <div class="container-fluid">
               <div class="row">
                  <div class="col-lg-12">
                     <div class="page concept  - topic-topic concept-concept " id="salt-event-system">
                        
                        <h1 class="title topictitle1">Salt Event System</h1>
                        <div class="body conbody">
                           <p class="p">The Salt Event System is used to fire off events enabling third party
                              applications or external processes to react to behavior within Salt.
                           </p>
                           
                           <p class="p">The event system is comprised of a two primary components:</p>
                           
                           <blockquote class="lq">
                              <ul class="ul">
                                 <li class="li">
                                    <p class="p">The event sockets which publishes events.</p>
                                    
                                 </li>
                                 
                                 <li class="li">
                                    <p class="p">The event library which can listen to events and send events into the salt system.</p>
                                    
                                 </li>
                                 
                              </ul>
                              
                           </blockquote>
                           
                           <div class="section" id="salt-event-system__event-types">
                              <h2 class="title sectiontitle">Event types</h2>
                              <ul class="ul">
                                 <li class="li"><a class="xref" href="unresolvable-reference.html#__">Salt Master Events</a><ul class="ul">
                                       <li class="li"><a class="xref" href="master_events.html#salt-master-events__authentication-events">Authentication events</a></li>
                                       
                                       <li class="li"><a class="xref" href="master_events.html#salt-master-events__start-events">Start events</a></li>
                                       
                                       <li class="li"><a class="xref" href="master_events.html#salt-master-events__key-events">Key events</a></li>
                                       
                                       <li class="li"><a class="xref" href="master_events.html#salt-master-events__job-events">Job events</a></li>
                                       
                                       <li class="li"><a class="xref" href="master_events.html#salt-master-events__presence-events">Presence events</a></li>
                                       
                                       <li class="li"><a class="xref" href="master_events.html#salt-master-events__cloud-events">Cloud Events</a></li>
                                       
                                    </ul>
                                    
                                 </li>
                                 
                              </ul>
                              
                           </div>
                           
                           <div class="section" id="salt-event-system__listening-for-events">
                              <h2 class="title sectiontitle">Listening for Events</h2>
                              <p class="p">The event system is accessed via the event library and can only be accessed
                                 by the same system user that Salt is running as. To listen to events a
                                 SaltEvent object needs to be created and then the get_event function needs to
                                 be run. The SaltEvent object needs to know the location that the Salt Unix
                                 sockets are kept. In the configuration this is the <tt class="ph tt">sock_dir</tt> option. The
                                 <tt class="ph tt">sock_dir</tt> option defaults to "/var/run/salt/master" on most systems.
                              </p>
                              
                              <p class="p">The following code will check for a single event:</p>
                              <pre class="pre codeblock language-python">import salt.utils.event

event = salt.utils.event.MasterEvent('/var/run/salt/master')

data = event.get_event()</pre>
                              <p class="p">Events will also use a "tag". Tags allow for events to be filtered by prefix.
                                 By default all events will be returned. If only authentication events are
                                 desired, then pass the tag "salt/auth".
                              </p>
                              
                              <p class="p">The <tt class="ph tt">get_event</tt> method has a default poll time assigned of 5 seconds. To
                                 change this time set the "wait" option.
                              </p>
                              
                              <p class="p">The following example will only listen for auth events and will wait for 10 seconds
                                 instead of the default 5.
                              </p>
                              <pre class="pre codeblock language-python">import salt.utils.event

event = salt.utils.event.MasterEvent('/var/run/salt/master')

data = event.get_event(wait=10, tag='salt/auth')</pre>
                              <p class="p">To retrieve the tag as well as the event data, pass <tt class="ph tt">full=True</tt>:
                              </p>
                              <pre class="pre codeblock language-python">import salt.utils.event

event = salt.utils.event.MasterEvent('/var/run/salt/master')

evdata = event.get_event(wait=10, tag='salt/job', full=True)

tag, data = evdata['tag'], evdata['data']

# tag == 'salt/job/JOBID/ret/MINIONNAME</pre>
                              <p class="p">Instead of looking for a single event, the <tt class="ph tt">iter_events</tt> method can be used to
                                 make a generator which will continually yield salt events.
                              </p>
                              
                              <p class="p">The iter_events method also accepts a tag but not a wait time:</p>
                              <pre class="pre codeblock language-python">import salt.utils.event

event = salt.utils.event.MasterEvent('/var/run/salt/master')

for data in event.iter_events(tag='salt/auth'):
    print(data)</pre>
                              </div>
                           
                           <div class="section" id="salt-event-system__firing-events">
                              <h2 class="title sectiontitle">Firing Events</h2>
                              <p class="p">It is possible to fire events on either the minion's local bus or to fire
                                 events intended for the master.
                              </p>
                              
                              <p class="p">To fire a local event from the minion, on the command line:</p>
                              <pre class="pre codeblock language-bash">salt-call event.fire '{"data": "message to be sent in the event"}' 'tag'</pre>
                              <p class="p">To fire an event to be sent to the master, from the minion:</p>
                              <pre class="pre codeblock language-bash">salt-call event.fire_master '{"data": "message for the master"}' 'tag'</pre>
                              <p class="p">If a process is listening on the minion, it may be useful for a user on the
                                 master to fire an event to it:
                              </p>
                              <pre class="pre codeblock language-python"># Job on minion
import salt.utils.event

event = salt.utils.event.MinionEvent(**__opts__)

for evdata in event.iter_events(tag='customtag/'):
    return evdata # do your processing here...</pre>
                              <pre class="pre codeblock language-bash">salt minionname event.fire '{"data": "message for the minion"}' 'customtag/african/unladen'</pre>
                              </div>
                           
                           <div class="section" id="salt-event-system__firing-events-from-code">
                              <h2 class="title sectiontitle">Firing Events From Code</h2>
                              <p class="p">Events can be very useful when writing execution modules, in order to inform
                                 various processes on the master when a certain task has taken place. In Salt
                                 versions previous to 0.17.0, the basic code looks like:
                              </p>
                              <pre class="pre codeblock language-python"># Import the proper library
import salt.utils.event
# Fire deploy action
sock_dir = '/var/run/salt/minion'
event = salt.utils.event.SaltEvent('master', sock_dir)
event.fire_event('Message to be sent', 'tag')</pre>
                              <p class="p">In Salt version 0.17.0, the ability to send a payload with a more complex data
                                 structure than a string was added. When using this interface, a Python
                                 dictionary should be sent instead.
                              </p>
                              <pre class="pre codeblock language-python"># Import the proper library
import salt.utils.event
# bring in the system configuration
import salt.config
cfg = salt.config.minion_config("/etc/salt/minion")
# Fire deploy action
sock_dir = '/var/run/salt/minion'
payload = {'sample-msg': 'this is a test',
           'example': 'this is the same test'}
event = salt.utils.event.SaltEvent('master', sock_dir, opts=cfg)
event.fire_event(payload, 'tag')</pre>
                              <p class="p">It should be noted that this code can be used in 3rd party applications as well.
                                 So long as the salt-minion process is running, the minion socket can be used:
                              </p>
                              <pre class="pre codeblock language-python">sock_dir = '/var/run/salt/minion'</pre>
                              <p class="p">So long as the salt-master process is running, the master socket can be used:</p>
                              <pre class="pre codeblock language-python">sock_dir = '/var/run/salt/master'</pre>
                              <p class="p">This allows 3rd party applications to harness the power of the Salt event bus
                                 programmatically, without having to make other calls to Salt.
                              </p>
                              
                              <p class="p">A 3rd party process can listen to the event bus on the master and another 3rd party
                                 process can fire events to the process on the master, which Salt will happily
                                 pass along.
                              </p>
                              
                              <p class="p">To fire an event to be sent to the master, from the minion, from code:</p>
                              <pre class="pre codeblock language-python">import salt.utils.event
import salt.config
cfg = salt.config.minion_config("/etc/salt/minion")
sock_dir = '/var/run/salt/minion'
tag = "tag"
payload = {'sample-msg": "this is a test'}
# The message wrapper
# Create an event interface
event = salt.utils.event.SaltEvent("minion", sock_dir, opts=cfg)
# Fire the event across
event.fire_master(payload, tag)</pre>
                              </div>
                           
                        </div>
                        
                        <div xmlns:htmlutil="http://dita4publishers.org/functions/htmlutil" class="related-links">
                           
                           <ul class="ullinks">
                              
                              <li class="link ulchildlink"><strong><a href="master_events.html">Salt Master Events</a></strong><br>
                                 
                              </li>
                              
                           </ul>
                           
                        </div>
                     </div>
                     <button id="next-button" type="button" class="btn btn-primary">
                        Next <span class="glyphicon glyphicon-chevron-right"></span></button><div class="footer">
                        <p class="text-muted pull-right"><small>Copyright © 2015 SaltStack.</small></p>
                     </div>
                  </div>
               </div>
            </div>
         </div>
      </div>
   </body>
</html>